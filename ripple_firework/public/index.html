<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Fireworks Animation</title>
    <style>
        body,
        html {
            height: 100%;
            width: 100%;
            margin: 0px;
        }

        body {
            overflow: hidden;
            background-color: black;
        }
    </style>
</head>

<body>
    <audio id="audioPlayer" src="./firework.mp3" preload="auto" type="audio/mpeg"></audio>
    <audio id="audioPlayer2" src="./wow.mp3" preload="auto" type="audio/mpeg"></audio>

    <?xml version="1.0" encoding="UTF-8"?>

    <svg id="ripple-template" version="1.1" xmlns="http://www.w3.org/2000/svg"
        style="background: none; display:none; shape-rendering: auto;" viewBox="-250 -250 500 500"
        preserveAspectRatio="xMidYMid">


        <defs>
            <style>
                .cls-1 {
                  clip-path: url(#clippath);
                }
            
                .cls-2 {
                  fill: none;
                }
            
                .cls-2, .cls-3 {
                  stroke-width: 0px;
                }
              </style>
        
        
        
            <clipPath id="clippath">
              <rect class="cls-2" y="0" width= "100" height= "100"/>
            </clipPath>
          </defs>
         
          <g class="cls-1" style="transform-origin: center; transform-box: fill-box;">
                  <path class="cls-3" d="M229.75,24.08c0-3.65-3.58-6.62-8-6.62s-8,2.96-8,6.62l6.31,66.04c.57,3.15,1.09,5.67,1.93,5.67.71,0,1.13-2.02,1.88-5.63l5.88-66.08Z"/>
                  <path class="cls-3" d="M245.92,88.07c5.05-12.91,10.36-25.7,17.18-37.83.79-1.36,1.85-3.04,2.76-4.32,6.02-8.44,12.59-16.43,20.35-23.41,4.83-4.66,10.3-9.83,17.51-10.48,2.5-.16,5.24.15,8.02,1.93.42.27.57.81.36,1.25-2.13,5.01-4.18,7.59-7.86,10.59-2.88,2.46-6.4,4.21-9.53,6.67-7.02,5.69-13.71,12.07-19.94,18.69-4.94,5.16-8.91,11.04-13.13,16.86-4.89,6.82-9.66,13.78-14.56,20.67-.21.3-.62.37-.91.16-.25-.17-.34-.5-.24-.77h0Z"/>
                  <path class="cls-3" d="M194.64,99.15c-7.92-11.09-15.45-22.44-23.8-33.12-.83-1.06-1.94-2.31-2.85-3.29-6.54-7.03-13.58-13.8-20.99-19.81-3.13-2.46-6.65-4.21-9.53-6.67-3.68-2.99-5.73-5.57-7.86-10.59-.21-.45-.04-.99.36-1.25,2.77-1.78,5.51-2.09,8.02-1.93,7.21.65,12.68,5.82,17.51,10.48,8.15,7.38,15.09,15.82,21.3,24.81,1.2,1.8,2.41,3.91,3.43,5.78,5.97,11.35,10.95,23.04,15.56,34.97.13.34-.04.72-.38.84-.28.11-.6,0-.77-.24h0Z"/>
                  <path class="cls-3" d="M158.43,108.52c-14.56-7.47-28.91-15.37-43.76-22.08-1.16-.53-2.88-1.19-4.06-1.63-11.24-3.96-22.87-7.32-34.53-9.55-10.24-1.54-19.53-.88-28.57-7.09-.43-.27-.56-.85-.27-1.27,3.78-5.46,9.73-6.93,15.67-7.11,5.53-.15,10.77,1.41,15.89,2.67,12.43,2.94,24.23,7.63,35.68,13.14,7.25,3.7,13.95,8.54,20.52,13.2,8.24,6,16.31,12.16,24.15,18.64.28.23.32.64.09.92-.2.24-.54.3-.81.16h0Z"/>
                  <path class="cls-3" d="M285.8,109.79c11.87-9.68,23.96-18.96,36.84-27.33,2.15-1.36,4.62-2.85,6.91-4.02,6.97-3.49,14.15-6.5,21.51-9.16,4.91-1.75,9.94-3.22,15.09-4.46,7.7-2.04,16.24-4.18,24.18-1.24,2.7,1.07,5.38,2.7,7.39,5.67.28.41.17.97-.24,1.25-5.12,3.36-9.11,4.54-14.53,5.43-4.55.85-9.32.83-14.07,1.68-11.66,2.23-23.29,5.59-34.53,9.55-1.18.44-2.91,1.1-4.06,1.63-14.86,6.71-29.2,14.61-43.76,22.08-.32.17-.71.04-.88-.27-.15-.28-.07-.61.16-.81h0Z"/>
                  <path class="cls-3" d="M143.35,140.37c-18.83-.36-37.67-1.22-56.43-.55-1.48.05-3.61.25-5.08.4-13.67,1.68-27.42,4.18-40.62,7.93-5.37,1.58-10.34,3.99-15.49,5.58-5.86,1.93-10.62,3.13-17.37,2.86-.51-.02-.9-.51-.8-1.01.74-3.8,2.72-6.67,4.98-9.04,6.77-6.79,16.44-9.09,25.33-11.04,5.89-1.41,11.79-2.52,17.72-3.31,8.5-1.11,17.01-1.72,25.55-1.94,1.68,0,4.14.04,5.82.16,19.08,1.4,37.84,4.91,56.54,8.67.35.07.58.42.5.77-.07.31-.35.52-.66.52h0Z"/>
                  <path class="cls-3" d="M295.93,136.14c17.23-3.53,34.5-6.6,52.06-8.35,2.9-.26,6.18-.48,9.12-.47,8.94.1,17.84.8,26.74,1.93,5.92.79,11.82,1.89,17.72,3.31,8.89,1.96,18.56,4.25,25.33,11.04,2.26,2.37,4.24,5.24,4.98,9.04.1.51-.3,1.01-.82,1.01-3.78.15-6.68-.18-9.48-.68-8.21-1.62-15.31-5.25-23.36-7.76-12.86-3.65-26.25-6.12-39.56-7.8-1.87-.24-4.24-.46-6.14-.53-18.76-.67-37.6.19-56.43.55-.36.01-.66-.27-.67-.63,0-.32.22-.59.52-.66h0Z"/>
                  <path class="cls-3" d="M132.53,183.48c-10.7,5.41-21.34,11.04-31.8,16.89-7.67,4.4-15.23,8.73-22.32,13.88-6.94,5.18-13.72,10.94-20.06,16.74-4.26,3.9-8.53,7.69-12.55,11.62-5.96,5.98-11.35,12.09-18.47,16.8-2.55,1.59-5.35,3.05-9.42,4.52-.47.18-1-.04-1.2-.5-5.52-13.65,5.98-27.09,15.54-35.32,11.28-10.36,24.52-17.95,37.92-25.04,8.69-4.31,18.19-7.13,27.29-10.16,11.51-3.76,23.05-7.21,34.59-10.63.35-.1.71.09.81.44.09.31-.06.63-.34.77h0Z"/>
                  <path class="cls-3" d="M309.06,179.14c17.41,5.19,34.76,10.34,51.92,16.53,2.85,1.05,6.07,2.34,8.83,3.71,8.28,4.21,16.39,8.87,24.2,13.98,5.19,3.46,10.14,7.34,14.85,11.6,7.37,6.44,14.37,14.04,16.57,23.97.64,3.48.71,7.3-1.03,11.35-.2.46-.71.68-1.17.51-12.27-4.17-19.27-12.66-27.91-21.32-10.37-9.8-21.1-19.75-32.61-28.36-11.97-8.54-25.13-15.49-38.12-22.48-5.3-2.82-10.63-5.6-16-8.3-.32-.16-.45-.55-.29-.87.14-.29.47-.42.77-.34h0Z"/>
                  <path class="cls-3" d="M123.74,236.07c-13.3,21.78-27.57,42.94-40.2,65.06-6.13,10.81-11.58,22.12-17.69,32.89-6.14,11.29-12.51,23.2-23.71,30.33-.43.28-1.01.14-1.26-.3-2.06-3.59-2.81-7.37-2.97-11.28-.03-10.4,3.73-20.12,8.54-29.09,3.04-5.89,6.4-11.56,10.15-16.97,7.59-10.7,15.57-21.39,24.76-30.74,13.4-14.03,27.23-27.49,41.39-40.73.27-.25.68-.23.93.03.21.22.23.55.08.79h0Z"/>
                  <path class="cls-3" d="M305.68,225.7c13.46,13.96,26.58,28.11,39.23,42.82,4.17,4.91,8.65,10.14,12.22,15.59,7.54,10.8,14.85,21.74,20.18,33.86,2.82,6.08,5.3,12.33,6.35,19.04.86,5.18,1.27,10.71-.34,15.95-.55,1.86-1.32,3.74-2.53,5.6-.27.42-.83.53-1.25.26-10.84-7.7-16.59-19.94-22.15-31.54-5.54-11.08-10.41-22.65-15.97-33.76-5.65-11.26-11.74-22.33-18.01-33.32-6.26-11.21-12.58-22.41-18.78-33.73-.17-.32-.06-.72.26-.89.26-.15.59-.09.79.12h0Z"/>
                  <path class="cls-3" d="M169.58,258.78c-4.96,27.03-11.13,53.84-15.21,80.97-1.94,13.28-3.04,26.77-4.88,40.02-.79,6.6-1.48,13.16-3.07,19.64-1.5,7.03-3.7,14.15-7.91,20.24-.28.43-.9.52-1.29.18-3.29-2.83-5.38-6.33-6.96-10.14-3.88-10.43-3.88-21.58-2.62-32.42.73-7.09,1.84-14.09,3.42-20.98,3.3-13.72,7-27.56,12.4-40.58,7.73-19.39,16.11-38.41,24.88-57.34.15-.33.54-.47.87-.32.28.13.42.43.37.72h0Z"/>
                  <path class="cls-3" d="M268.64,258.38c8.77,18.93,17.15,37.94,24.88,57.34,2.53,6.46,5.23,13.32,6.99,20.11,3.92,13.6,7.53,27.29,8.84,41.45.8,7.16,1.19,14.36.06,21.55-.82,5.55-2.18,11.28-5.42,16.13-1.12,1.71-2.47,3.37-4.23,4.87-.36.31-.91.27-1.22-.1-4.26-6.1-6.47-13.27-7.98-20.33-1.59-6.48-2.28-13.04-3.07-19.64-1.84-13.25-2.94-26.74-4.88-40.02-1.98-13.44-4.53-26.82-7.26-40.18-2.66-13.56-5.38-27.15-7.95-40.78-.07-.36.17-.7.52-.77.3-.06.59.1.72.37h0Z"/>
                  <path class="cls-3" d="M221.91,280.86c1.55,22.56,2.84,55.23,3.84,78.16.36,12.96,1.32,25.91.65,38.9-.22,6.57-.54,13.09-2.15,19.53-1.6,6.48-3.41,13.08-9.87,19.15-.35.33-.91.32-1.24-.04-5.51-6.87-6.75-13.33-7.84-19.84-.53-3.24-.84-6.48-.94-9.71-.12-9.75.17-19.47,1.09-29.21.83-8.13,1.79-16.27,2.67-24.41,1.64-11.06,3.54-22.99,5.41-33.98,2.24-12.89,4.54-25.76,7.08-38.62.07-.36.41-.59.77-.52.3.06.51.31.53.6h0Z"/>
                  <path class="cls-3" d="M157.76,241.23c-6.5,13.81-14.31,26.51-20.61,40.08-2.95,6.64-5.37,13.62-8.61,20.08-1.53,3.24-2.84,6.51-4.82,9.46-1.72,2.37-2.94,4.84-5.71,6.38-1.1.61-2.37,1.25-4.32,1.82-.44.13-.91.02-1.24-.25-1.55-1.26-2.37-2.48-3.07-3.7-1.63-3.12-1.02-6.56-.62-9.77.63-4.1,2.27-7.77,3.95-11.34,3.18-7.23,7.91-13.52,12.67-19.74,4.59-6.23,9.98-11.89,15.11-17.64,5.29-5.5,10.64-10.92,16.23-16.16.5-.49,1.39.13,1.05.77h0Z"/>
                  <path class="cls-3" d="M305.53,203.06c13.93,6.54,27.65,13.51,40.43,22.13,6.48,4.4,12.96,8.86,18.27,14.71,2.72,2.85,5.44,5.81,7.34,9.5,2.4,4.52,3.98,9.06.77,13.95-.26.4-.69.63-1.14.63-2.04.07-3.39-.13-4.63-.36-3.11-.57-5.06-2.54-7.44-4.24-2.82-2.18-5.09-4.86-7.57-7.45-5.12-5.11-9.63-10.96-14.53-16.32-10.26-10.87-21.71-20.46-32.24-31.49-.5-.48.1-1.39.75-1.06h0Z"/>
                  <path class="cls-3" d="M155.73,127.2c-9.28-.83-18.16-3.05-27.32-4.17-4.3-.44-8.79-.41-12.97-1.45-3.24-.51-6.21-1.44-8.76-3.65-1.44-1.5-2.05-3.2-3.07-5.71-.17-.43-.19-.89-.07-1.3.81-2.64,1.84-4.49,3.79-5.66,3.69-1.83,7.88-1.75,11.61-.8,4.9.82,9.26,3.19,13.58,5.48,4.32,2.14,8.35,4.9,12.39,7.46,3.85,2.74,7.64,5.54,11.32,8.61.51.4.14,1.29-.51,1.2h0Z"/>
                  <path class="cls-3" d="M263.49,105.29c3.98-7.21,8-14.31,12.9-20.95,2.21-2.72,4.55-5.76,6.86-8.38,1.6-1.79,3.38-3.42,5.27-4.94,1.88-1.52,3.78-3.14,6.18-4.08,1.18-.49,2.49-.82,3.84-1.02,1.98-.06,3.57.69,5.32,2.28.34.32.51.75.52,1.19.06,1.53-.03,2.53-.17,3.37-.12.9-.35,1.52-.63,2.03-1.73,2.85-4.25,4.67-6.92,6.57-3.39,2.73-7.23,5.03-10.78,7.6-3.59,2.68-6.93,5.66-10.45,8.52-3.62,2.89-7.24,5.81-10.95,8.65-.53.44-1.35-.24-.99-.84h0Z"/>

        <animate attributeName="opacity" dur="2s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1"
            calcMode="spline" begin="0s" fill="freeze"></animate>
        <animateTransform attributeName="transform" attributeType="XML" type="scale" from="0 0" to="1 1" dur="5s" />
        </g>
    </svg>

</body>
<script src="/socket.io/socket.io.js"></script>
<script>
    let clickCount = 0; // Counter to keep track of the clicks
    const audioPlayer = document.getElementById('audioPlayer');
    const audioPlayer2 = document.getElementById('audioPlayer2');


    // Function to change the color on each click
    function changeColor() {
        let color = 'rgb(' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ')';
        return color;
            
      
    }

    function setColor(color){
        paths.forEach(function (path) {
            console.log(color)
            path.style.fill = color;
        });

    }

    // Attach the function to the click event
    document.addEventListener('click', function (e) {
        console.log("click");

        // Function to add fireworks with a delay
        function addFireworkWithDelay(delay) {
            setTimeout(function () {
                const x = e.pageX + (Math.random() - 0.5) * 600 ;
                // const x = e.pageX;
                const y = e.pageY + (Math.random() - 0.5) * 600 ;
                // const y = e.pageY;
                let color = changeColor();
                console.log(color)
                setColor(color);
                add_ripple(x, y);
                socket.emit('ripple', { x:  offset_x + x, y: y, color: color  });

                audioPlayer.currentTime = 0;
                audioPlayer.play();

            }, delay * 1000);
        }

        // Add three fireworks with a delay of 0.5 seconds between each
        addFireworkWithDelay(0);
        addFireworkWithDelay(0.5);
        addFireworkWithDelay(1);
        // Play audioPlayer2 only on the last firework
        setTimeout(function (){
        audioPlayer2.currentTime = 0;
        audioPlayer2.play();
        }, 1500);

    

        clickCount++; // Increment the click counter

    });

     // JavaScript code to set random color for each path initially
     var paths = document.querySelectorAll('#ripple-template .cls-3');
    // paths.forEach(function(path) {
    //     var randomColor = 'rgb(' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ')';
    //     path.style.fill = randomColor;
    // });



    // Attach the function to the click event
    // document.addEventListener('click', function(e) {
    //     console.log("click");
    //     add_ripple(e.pageX, e.pageY);
    //     socket.emit('ripple', { x: offset_x + e.pageX, y: e.pageY });

    //     let audioPlayer = document.getElementById('audioPlayer');
    //     audioPlayer.currentTime = 0;
    //     audioPlayer.play();

    //     let audioPlayer2 = document.getElementById('audioPlayer2');
    //     audioPlayer.currentTime = 0;
    //     audioPlayer.play();

    //     changeColor();
    // });

    let offset_x = 0;


    const socket = io();
    // received a message from the server
    socket.on("msg", msg => {
        console.log(msg);
        socket.emit('dimensions', { width: document.documentElement.clientWidth });
    });

    // received a message from another client
    socket.on("client_msg", msg => {
        console.log(msg);
    });

    socket.on("connect", () => {
        socket.emit("client_msg", "Hello from the client " + socket.id);
    });

    // received a ripple event from another client
        socket.on("ripple", (msg) => {

            setColor(msg.color);
        console.log("ripplereceive");
        console.log(msg);
        add_ripple(msg.x -offset_x, msg.y);
    });

    socket.on("offset_x", (offset) => {
        console.log(offset);
        offset_x = offset;
    });


    // // create a ripple on click and send it to the other clients
    //     document.addEventListener('click', e => {
    //     console.log("click")
    //     add_ripple(e.pageX, e.pageY);
    //     socket.emit('ripple', { x: offset_x + e.pageX , y: e.pageY });
    //     let audioPlayer = document.getElementById('audioPlayer');
    //     audioPlayer.currentTime = 0
    //     audioPlayer.play();

    //     let audioPlayer2 = document.getElementById('audioPlayer2');
    //     audioPlayer.currentTime = 0
    //     audioPlayer.play();
    // });

    function add_ripple(x, y) {
        console.log({x,y})
        // make a copy of the ripple template
        let ripple_template = document.getElementById('ripple-template');
        let new_ripple = ripple_template.cloneNode(true);
        // avoid duplicate IDs
        new_ripple.id = 'ripple' + Math.random() * 1000;

        let width = 1000;
        let height = 1000;
        new_ripple.setAttribute("height", height + "px");
        new_ripple.setAttribute("width", width + "px");
        new_ripple.setAttribute("viewBox", "0 0 450 450"); 

        // set center of the ripple at the mouse position
        new_ripple.style.top = y - (height / 2) + 'px';
        new_ripple.style.left = x - (width / 2) + 'px';
        new_ripple.style.display = 'block';
        new_ripple.style.position = 'absolute';


        //let animate = new_ripple.querySelector('.last')
        // remove the ripple after the animation ends
        //animate.addEventListener('endEvent', () => {
        //    new_ripple.remove();
        //});
        document.body.appendChild(new_ripple);
    }

</script>

</html>
